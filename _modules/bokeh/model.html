<!DOCTYPE html>

<html lang="en">
<head>
<!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<meta charset="utf-8"/>
<title>bokeh.model — Panel 0.10.3 documentation</title>
<meta content="High-level dashboarding for python visualization libraries" name="description"/>
<meta content="Panel contributors" name="author"/>
<!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
    WebFont.load({
      google: {
        families: ['Source Sans Pro']
      }
    });
  </script>
<!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="../../_static/css/main.css" rel="stylesheet"/>
<link href="../../_static/nbsite.css" rel="stylesheet"/>
<link href="../../_static/site.css" rel="stylesheet"/>
<!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<script src="../../_static/js/main.js"></script>
<!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="../../_static/favicon.ico" rel="icon" type="image/png"/>
<!-- Canonical
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="https://panel.holoviz.org/_modules/bokeh/model.html" rel="canonical">
</link></head>
<body class="">
<header class="navigation">
<div class="wrapper">
<a class="logo" href="../../index.html">
<img alt="Logo" src="../../_static/logo_horizontal.png"/>
</a>
<a class="navigation-menu-button" href="javascript:void(0)" id="js-mobile-menu">Menu</a>
<nav>
<ul class="navigation-menu show" id="js-navigation-menu">
<li class="nav-link doc-head"><a href="//discourse.holoviz.org">Discourse</a></li>
<li class="nav-link doc-head"><a href="//twitter.com/Panel_org">Twitter</a></li>
<li class="nav-link doc-head"><a href="//github.com/pyviz/panel">Github</a></li>
<li class="nav-link">
<div style="display:inline-block;vertical-align: middle;">
<div class="search-bar">
<form action="../../search.html" method="get" role="search">
<input name="q" placeholder="Search" type="search"/>
<button type="submit">
<img alt="Search Icon" src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png"/>
</button>
</form>
</div>
</div>
</li>
</ul>
</nav>
</div>
</header>
<div class="second-nav">
<nav>
<ul class="navigation-menu show">
<li class="nav-link doc-head"><a href="../../getting_started/index.html">Getting started</a></li>
<li class="nav-link doc-head"><a href="../../user_guide/index.html">User Guide</a></li>
<li class="nav-link doc-head"><a href="../../gallery/index.html">Gallery</a></li>
<li class="nav-link doc-head"><a href="../../reference/index.html">Reference Gallery</a></li>
<li class="nav-link doc-head"><a href="../../developer_guide/index.html">Developer Guide</a></li>
<li class="nav-link doc-head"><a href="../../releases.html">Releases</a></li>
<li class="nav-link doc-head"><a href="../../api/index.html">API</a></li>
<li class="nav-link doc-head"><a href="../../FAQ.html">FAQ</a></li>
<li class="nav-link doc-head"><a href="../../about.html">About</a></li>
</ul>
</nav>
</div>
<!-- MAIN BODY OF DOCS –––––––––––––––––– -->
<div class="docs section">
<div id="hacketyhackhack"> <!-- style="width:20%;margin-right: 100px;"> --> <!--style="display: none;"> style="display:none;"> -->
<div class="toc" style="width:15%; margin-right:20px;">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Comparisons.html">Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Roadmap.html">Road Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pyviz/panel">Github source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>
</div>
</div>
<div class="content"> <!-- style="max-width:80%;margin-left:auto;margin-right: auto;">-->
<h1>Source code for bokeh.model</h1><div class="highlight"><pre>
<span></span><span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2012 - 2020, Anaconda, Inc., and Bokeh Contributors.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># The full license is in the file LICENSE.txt, distributed with this software.</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="sd">''' Provide a base class for all objects (called Bokeh Models) that can go in</span>
<span class="sd">a Bokeh |Document|.</span>

<span class="sd">'''</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Boilerplate</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">logging</span> <span class="c1"># isort:skip</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Imports</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1"># Standard library imports</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="c1"># Bokeh imports</span>
<span class="kn">from</span> <span class="nn">.core.has_props</span> <span class="kn">import</span> <span class="n">HasProps</span><span class="p">,</span> <span class="n">abstract</span>
<span class="kn">from</span> <span class="nn">.core.json_encoder</span> <span class="kn">import</span> <span class="n">serialize_json</span>
<span class="kn">from</span> <span class="nn">.core.properties</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">.events</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">.themes</span> <span class="kn">import</span> <span class="n">default</span> <span class="k">as</span> <span class="n">default_theme</span>
<span class="kn">from</span> <span class="nn">.util.callback_manager</span> <span class="kn">import</span> <span class="n">EventCallbackManager</span><span class="p">,</span> <span class="n">PropertyCallbackManager</span>
<span class="kn">from</span> <span class="nn">.util.serialization</span> <span class="kn">import</span> <span class="n">make_id</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Globals and constants</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">'collect_models'</span><span class="p">,</span>
    <span class="s1">'get_class'</span><span class="p">,</span>
    <span class="s1">'Model'</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># General API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Dev API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">collect_filtered_models</span><span class="p">(</span><span class="n">discard</span><span class="p">,</span> <span class="o">*</span><span class="n">input_values</span><span class="p">):</span>
    <span class="sd">''' Collect a duplicate-free list of all other Bokeh models referred to by</span>
<span class="sd">    this model, or by any of its references, etc, unless filtered-out by the</span>
<span class="sd">    provided callable.</span>

<span class="sd">    Iterate over ``input_values`` and descend through their structure</span>
<span class="sd">    collecting all nested ``Models`` on the go.</span>

<span class="sd">    Args:</span>
<span class="sd">        *discard (Callable[[Model], bool])</span>
<span class="sd">            a callable which accepts a *Model* instance as its single argument</span>
<span class="sd">            and returns a boolean stating whether to discard the instance. The</span>
<span class="sd">            latter means that the instance will not be added to collected</span>
<span class="sd">            models nor will its references be explored.</span>

<span class="sd">        *input_values (Model)</span>
<span class="sd">            Bokeh models to collect other models from</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    '''</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">collected</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">queued</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">queue_one</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">callable</span><span class="p">(</span><span class="n">discard</span><span class="p">)</span> <span class="ow">and</span> <span class="n">discard</span><span class="p">(</span><span class="n">obj</span><span class="p">)):</span>
            <span class="n">queued</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_values</span><span class="p">:</span>
        <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">queue_one</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">queued</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">queued</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">collected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">_visit_immediate_value_references</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">queue_one</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">collected</span>

<span class="k">def</span> <span class="nf">collect_models</span><span class="p">(</span><span class="o">*</span><span class="n">input_values</span><span class="p">):</span>
    <span class="sd">''' Collect a duplicate-free list of all other Bokeh models referred to by</span>
<span class="sd">    this model, or by any of its references, etc.</span>

<span class="sd">    Iterate over ``input_values`` and descend through their structure</span>
<span class="sd">    collecting all nested ``Models`` on the go. The resulting list is</span>
<span class="sd">    duplicate-free based on objects' identifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        *input_values (Model)</span>
<span class="sd">            Bokeh models to collect other models from</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Model] : all models reachable from this one.</span>

<span class="sd">    '''</span>
    <span class="k">return</span> <span class="n">collect_filtered_models</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">input_values</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_class</span><span class="p">(</span><span class="n">view_model_name</span><span class="p">):</span>
    <span class="sd">''' Look up a Bokeh model class, given its view model name.</span>

<span class="sd">    Args:</span>
<span class="sd">        view_model_name (str) :</span>
<span class="sd">            A view model name for a Bokeh model to look up</span>

<span class="sd">    Returns:</span>
<span class="sd">        Model: the model class corresponding to ``view_model_name``</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError, if the model cannot be found</span>

<span class="sd">    Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            &gt;&gt;&gt; from bokeh.model import get_class</span>
<span class="sd">            &gt;&gt;&gt; get_class("Range1d")</span>
<span class="sd">            &lt;class 'bokeh.models.ranges.Range1d'&gt;</span>

<span class="sd">    '''</span>

    <span class="c1"># in order to look up from the model catalog that Model maintains, it</span>
    <span class="c1"># has to be creates first. These imports ensure that all built-in Bokeh</span>
    <span class="c1"># models are represented in the catalog.</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span><span class="p">;</span> <span class="n">models</span>
    <span class="kn">from</span> <span class="nn">.plotting</span> <span class="kn">import</span> <span class="n">Figure</span><span class="p">;</span> <span class="n">Figure</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_class_reverse_map</span>
    <span class="k">if</span> <span class="n">view_model_name</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="n">view_model_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"View model name '</span><span class="si">%s</span><span class="s2">' not found"</span> <span class="o">%</span> <span class="n">view_model_name</span><span class="p">)</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Dev API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="n">_HTML_REPR</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">&lt;script&gt;</span>
<span class="s2">(function() {</span>
<span class="s2">  var expanded = false;</span>
<span class="s2">  var ellipsis = document.getElementById("</span><span class="si">%(ellipsis_id)s</span><span class="s2">");</span>
<span class="s2">  ellipsis.addEventListener("click", function() {</span>
<span class="s2">    var rows = document.getElementsByClassName("</span><span class="si">%(cls_name)s</span><span class="s2">");</span>
<span class="s2">    for (var i = 0; i &lt; rows.length; i++) {</span>
<span class="s2">      var el = rows[i];</span>
<span class="s2">      el.style.display = expanded ? "none" : "table-row";</span>
<span class="s2">    }</span>
<span class="s2">    ellipsis.innerHTML = expanded ? "&amp;hellip;)" : "&amp;lsaquo;&amp;lsaquo;&amp;lsaquo;";</span>
<span class="s2">    expanded = !expanded;</span>
<span class="s2">  });</span>
<span class="s2">})();</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">"""</span>

<span class="nd">@abstract</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">HasProps</span><span class="p">,</span> <span class="n">PropertyCallbackManager</span><span class="p">,</span> <span class="n">EventCallbackManager</span><span class="p">):</span>
    <span class="sd">''' Base class for all objects stored in Bokeh  |Document| instances.</span>

<span class="sd">    '''</span>

    <span class="n">model_class_reverse_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>

        <span class="c1"># use an explicitly provided view model name if there is one</span>
        <span class="k">if</span> <span class="s2">"__view_model__"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">__view_model__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="s2">"__view_module__"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">__view_module__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span>

        <span class="n">module</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__view_module__</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"__subtype__"</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__view_model__</span><span class="p">)</span>
        <span class="n">impl</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"__implementation__"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">head</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">"bokeh"</span> <span class="ow">or</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">"__main__"</span> <span class="ow">or</span> <span class="n">impl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">qualified</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qualified</span> <span class="o">=</span> <span class="n">module</span> <span class="o">+</span> <span class="s2">"."</span> <span class="o">+</span> <span class="n">model</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">__qualified_model__</span> <span class="o">=</span> <span class="n">qualified</span>

        <span class="c1"># update the mapping of view model names to classes, checking for any duplicates</span>
        <span class="c1"># and handling any subtype relationships or custom implementations</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">model_class_reverse_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">qualified</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">"__implementation__"</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Duplicate qualified model declaration of '</span><span class="si">{</span><span class="n">qualified</span><span class="si">}</span><span class="s2">'. Previous definition: </span><span class="si">{</span><span class="n">previous</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">model_class_reverse_map</span><span class="p">[</span><span class="n">qualified</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span>  <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="n">make_id</span><span class="p">())</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_document</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_temp_document</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># "id" is popped from **kw in __new__, so in an ideal world I don't</span>
        <span class="c1"># think it should be here too. But Python does this, so it is:</span>
        <span class="c1">#</span>
        <span class="c1"># class Foo(object):</span>
        <span class="c1">#     def __new__(cls, *args, **kw):</span>
        <span class="c1">#         obj = super().__new__(cls)</span>
        <span class="c1">#         obj.bar = kw.pop("bar", 111)</span>
        <span class="c1">#         print("__new__  :", id(kw), kw)</span>
        <span class="c1">#         return obj</span>
        <span class="c1">#     def __init__(self, **kw):</span>
        <span class="c1">#         print("__init__ :", id(kw), kw)</span>
        <span class="c1">#</span>
        <span class="c1"># &gt;&gt;&gt; f = Foo(bar=10)</span>
        <span class="c1"># __new__  : 4405522296 {}</span>
        <span class="c1"># __init__ : 4405522296 {'bar': 10}</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">default_theme</span><span class="o">.</span><span class="n">apply_to_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">(id=</span><span class="si">%r</span><span class="s2">, ...)"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">    An arbitrary, user-supplied name for this model.</span>

<span class="s2">    This name can be useful when querying the document to retrieve specific</span>
<span class="s2">    Bokeh models.</span>

<span class="s2">    .. code:: python</span>

<span class="s2">        &gt;&gt;&gt; plot.circle([1,2,3], [4,5,6], name="temp")</span>
<span class="s2">        &gt;&gt;&gt; plot.select(name="temp")</span>
<span class="s2">        [GlyphRenderer(id='399d53f5-73e9-44d9-9527-544b761c7705', ...)]</span>

<span class="s2">    .. note::</span>
<span class="s2">        No uniqueness guarantees or other conditions are enforced on any names</span>
<span class="s2">        that are provided, nor is the name used directly by Bokeh for any</span>
<span class="s2">        reason.</span>

<span class="s2">    """</span><span class="p">)</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">    An optional list of arbitrary, user-supplied values to attach to this</span>
<span class="s2">    model.</span>

<span class="s2">    This data can be useful when querying the document to retrieve specific</span>
<span class="s2">    Bokeh models:</span>

<span class="s2">    .. code:: python</span>

<span class="s2">        &gt;&gt;&gt; r = plot.circle([1,2,3], [4,5,6])</span>
<span class="s2">        &gt;&gt;&gt; r.tags = ["foo", 10]</span>
<span class="s2">        &gt;&gt;&gt; plot.select(tags=['foo', 10])</span>
<span class="s2">        [GlyphRenderer(id='1de4c3df-a83d-480a-899b-fb263d3d5dd9', ...)]</span>

<span class="s2">    Or simply a convenient way to attach any necessary metadata to a model</span>
<span class="s2">    that can be accessed by ``CustomJS`` callbacks, etc.</span>

<span class="s2">    .. note::</span>
<span class="s2">        No uniqueness guarantees or other conditions are enforced on any tags</span>
<span class="s2">        that are provided, nor are the tags used directly by Bokeh for any</span>
<span class="s2">        reason.</span>

<span class="s2">    """</span><span class="p">)</span>

    <span class="n">js_event_callbacks</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">List</span><span class="p">(</span><span class="n">Instance</span><span class="p">(</span><span class="s2">"bokeh.models.callbacks.CustomJS"</span><span class="p">)),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">    A mapping of event names to lists of ``CustomJS`` callbacks.</span>

<span class="s2">    Typically, rather then modifying this property directly, callbacks should be</span>
<span class="s2">    added using the ``Model.js_on_event`` method:</span>

<span class="s2">    .. code:: python</span>

<span class="s2">        callback = CustomJS(code="console.log('tap event occurred')")</span>
<span class="s2">        plot.js_on_event('tap', callback)</span>
<span class="s2">    """</span><span class="p">)</span>

    <span class="n">subscribed_events</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">    List of events that are subscribed to by Python callbacks. This is</span>
<span class="s2">    the set of events that will be communicated from BokehJS back to</span>
<span class="s2">    Python for this model.</span>
<span class="s2">    """</span><span class="p">)</span>

    <span class="n">js_property_callbacks</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">List</span><span class="p">(</span><span class="n">Instance</span><span class="p">(</span><span class="s2">"bokeh.models.callbacks.CustomJS"</span><span class="p">)),</span> <span class="n">help</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">    A mapping of attribute names to lists of ``CustomJS`` callbacks, to be set up on</span>
<span class="s2">    BokehJS side when the document is created.</span>

<span class="s2">    Typically, rather then modifying this property directly, callbacks should be</span>
<span class="s2">    added using the ``Model.js_on_change`` method:</span>

<span class="s2">    .. code:: python</span>

<span class="s2">        callback = CustomJS(code="console.log('stuff')")</span>
<span class="s2">        plot.x_range.js_on_change('start', callback)</span>

<span class="s2">    """</span><span class="p">)</span>

    <span class="c1"># Properties --------------------------------------------------------------</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' The |Document| this model is attached to (can be ``None``)</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_document</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_document</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">struct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' A Bokeh protocol "structure" of this model, i.e. a dict of the form:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            {</span>
<span class="sd">                'type' : &lt;&lt; view model name &gt;&gt;</span>
<span class="sd">                'id'   : &lt;&lt; unique model id &gt;&gt;</span>
<span class="sd">            }</span>

<span class="sd">        Additionally there may be a `subtype` field if this model is a subtype.</span>

<span class="sd">        '''</span>
        <span class="n">this</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'type'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qualified_model__</span><span class="p">,</span>
            <span class="s1">'id'</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="s2">"__subtype__"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="c1"># XXX: remove __subtype__ and this garbage at 2.0</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">this</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span>
            <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__view_model__</span>
            <span class="n">this</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="n">this</span><span class="p">[</span><span class="s2">"subtype"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subtype__</span>

        <span class="k">return</span> <span class="n">this</span>

    <span class="c1"># Public methods ----------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">js_on_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">Event</span><span class="p">]],</span> <span class="o">*</span><span class="n">callbacks</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">Event</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">event_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"expected string event name or event class, got </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="n">all_callbacks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">js_event_callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">[]))</span>

        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_callbacks</span><span class="p">:</span>
                <span class="n">all_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">js_event_callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_callbacks</span>

    <span class="k">def</span> <span class="nf">js_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">other_attr</span><span class="p">,</span> <span class="n">attr_selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Link two Bokeh model properties using JavaScript.</span>

<span class="sd">        This is a convenience method that simplifies adding a CustomJS callback</span>
<span class="sd">        to update one Bokeh model property whenever another changes value.</span>

<span class="sd">        Args:</span>

<span class="sd">            attr (str) :</span>
<span class="sd">                The name of a Bokeh property on this model</span>

<span class="sd">            other (Model):</span>
<span class="sd">                A Bokeh model to link to self.attr</span>

<span class="sd">            other_attr (str) :</span>
<span class="sd">                The property on ``other`` to link together</span>

<span class="sd">            attr_selector (Union[int, str]) :</span>
<span class="sd">                The index to link an item in a subscriptable ``attr``</span>

<span class="sd">        Added in version 1.1</span>

<span class="sd">        Raises:</span>

<span class="sd">            ValueError</span>

<span class="sd">        Examples:</span>

<span class="sd">            This code with ``js_link``:</span>

<span class="sd">            .. code :: python</span>

<span class="sd">                select.js_link('value', plot, 'sizing_mode')</span>

<span class="sd">            is equivalent to the following:</span>

<span class="sd">            .. code:: python</span>

<span class="sd">                from bokeh.models import CustomJS</span>
<span class="sd">                select.js_on_change('value',</span>
<span class="sd">                    CustomJS(args=dict(other=plot),</span>
<span class="sd">                             code="other.sizing_mode = this.value"</span>
<span class="sd">                    )</span>
<span class="sd">                )</span>

<span class="sd">            Additionally, to use attr_selector to attach the left side of a range slider to a plot's x_range:</span>

<span class="sd">            .. code :: python</span>

<span class="sd">                range_slider.js_link('value', plot.x_range, 'start', attr_selector=0)</span>

<span class="sd">            which is equivalent to:</span>

<span class="sd">            .. code :: python</span>

<span class="sd">                from bokeh.models import CustomJS</span>
<span class="sd">                range_slider.js_on_change('value',</span>
<span class="sd">                    CustomJS(args=dict(other=plot.x_range),</span>
<span class="sd">                             code="other.start = this.value[0]"</span>
<span class="sd">                    )</span>
<span class="sd">                )</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"</span><span class="si">%r</span><span class="s2"> is not a property of self (</span><span class="si">%r</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"'other' is not a Bokeh model: </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="n">other</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">other_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">properties</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"</span><span class="si">%r</span><span class="s2"> is not a property of other (</span><span class="si">%r</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">other_attr</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">CustomJS</span>

        <span class="n">selector</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="n">attr_selector</span><span class="si">!r}</span><span class="s2">]"</span> <span class="k">if</span> <span class="n">attr_selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">""</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">other</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="sa">f</span><span class="s2">"other.</span><span class="si">{</span><span class="n">other_attr</span><span class="si">}</span><span class="s2"> = this.</span><span class="si">{</span><span class="n">attr</span><span class="si">}{</span><span class="n">selector</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">js_on_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">callbacks</span><span class="p">):</span>
        <span class="sd">''' Attach a ``CustomJS`` callback to an arbitrary BokehJS model event.</span>

<span class="sd">        On the BokehJS side, change events for model properties have the</span>
<span class="sd">        form ``"change:property_name"``. As a convenience, if the event name</span>
<span class="sd">        passed to this method is also the name of a property on the model,</span>
<span class="sd">        then it will be prefixed with ``"change:"`` automatically:</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            # these two are equivalent</span>
<span class="sd">            source.js_on_change('data', callback)</span>
<span class="sd">            source.js_on_change('change:data', callback)</span>

<span class="sd">        However, there are other kinds of events that can be useful to respond</span>
<span class="sd">        to, in addition to property change events. For example to run a</span>
<span class="sd">        callback whenever data is streamed to a ``ColumnDataSource``, use the</span>
<span class="sd">        ``"stream"`` event on the source:</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            source.js_on_change('streaming', callback)</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">callbacks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"js_on_change takes an event name and one or more callbacks, got only one parameter"</span><span class="p">)</span>

        <span class="c1"># handle any CustomJS callbacks here</span>
        <span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">CustomJS</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CustomJS</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"not all callback values are CustomJS instances"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">():</span>
            <span class="n">event</span> <span class="o">=</span> <span class="s2">"change:</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">event</span>

        <span class="n">old</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">cb</span> <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">cbs</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cbs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_property_callbacks</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_property_callbacks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">js_property_callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_property_callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">js_property_callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s1">'js_property_callbacks'</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">js_property_callbacks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">plot</span><span class="p">):</span>
        <span class="sd">'''</span>

<span class="sd">        '''</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">on_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">callbacks</span><span class="p">):</span>
        <span class="sd">''' Add a callback on this object to trigger when ``attr`` changes.</span>

<span class="sd">        Args:</span>
<span class="sd">            attr (str) : an attribute name on this object</span>
<span class="sd">            *callbacks (callable) : callback functions to register</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Example:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            widget.on_change('value', callback1, callback2, ..., callback_n)</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"attempted to add a callback on nonexistent </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> property"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_change</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">callbacks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Returns all ``Models`` that this object has references to.</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">collect_models</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">''' Query this object and all of its references for objects that</span>
<span class="sd">        match the given selector.</span>

<span class="sd">        Args:</span>
<span class="sd">            selector (JSON-like) :</span>

<span class="sd">        Returns:</span>
<span class="sd">            seq[Model]</span>

<span class="sd">        '''</span>
        <span class="kn">from</span> <span class="nn">.core.query</span> <span class="kn">import</span> <span class="n">find</span>
        <span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="p">(),</span> <span class="n">selector</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">''' Query this object and all of its references for objects that</span>
<span class="sd">        match the given selector.  Raises an error if more than one object</span>
<span class="sd">        is found.  Returns single matching object, or None if nothing is found</span>
<span class="sd">        Args:</span>
<span class="sd">            selector (JSON-like) :</span>

<span class="sd">        Returns:</span>
<span class="sd">            Model</span>
<span class="sd">        '''</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Found more than one object matching </span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">updates</span><span class="p">):</span>
        <span class="sd">''' Update objects that match a given selector with the specified</span>
<span class="sd">        attribute/value updates.</span>

<span class="sd">        Args:</span>
<span class="sd">            selector (JSON-like) :</span>
<span class="sd">            updates (dict) :</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="n">isclass</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">selector</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">updates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_defaults</span><span class="p">):</span>
        <span class="sd">''' Returns a dictionary of the attributes of this object,</span>
<span class="sd">        containing only "JSON types" (string, number, boolean,</span>
<span class="sd">        none, dict, list).</span>

<span class="sd">        References to other objects are serialized as "refs" (just</span>
<span class="sd">        the object ID and type info), so the deserializer will</span>
<span class="sd">        need to separately have the full attributes of those</span>
<span class="sd">        other objects.</span>

<span class="sd">        There's no corresponding ``from_json()`` because to</span>
<span class="sd">        deserialize an object is normally done in the context of a</span>
<span class="sd">        Document (since the Document can resolve references).</span>

<span class="sd">        For most purposes it's best to serialize and deserialize</span>
<span class="sd">        entire documents.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_defaults (bool) : whether to include attributes</span>
<span class="sd">                that haven't been changed from the default</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_json_string</span><span class="p">(</span><span class="n">include_defaults</span><span class="o">=</span><span class="n">include_defaults</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">to_json_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_defaults</span><span class="p">):</span>
        <span class="sd">''' Returns a JSON string encoding the attributes of this object.</span>

<span class="sd">        References to other objects are serialized as references</span>
<span class="sd">        (just the object ID and type info), so the deserializer</span>
<span class="sd">        will need to separately have the full attributes of those</span>
<span class="sd">        other objects.</span>

<span class="sd">        There's no corresponding ``from_json_string()`` because to</span>
<span class="sd">        deserialize an object is normally done in the context of a</span>
<span class="sd">        Document (since the Document can resolve references).</span>

<span class="sd">        For most purposes it's best to serialize and deserialize</span>
<span class="sd">        entire documents.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_defaults (bool) : whether to include attributes</span>
<span class="sd">                that haven't been changed from the default</span>

<span class="sd">        '''</span>
        <span class="n">json_like</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_json_like</span><span class="p">(</span><span class="n">include_defaults</span><span class="o">=</span><span class="n">include_defaults</span><span class="p">)</span>
        <span class="n">json_like</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="c1"># serialize_json "fixes" the JSON from _to_json_like by converting</span>
        <span class="c1"># all types into plain JSON types # (it converts Model into refs,</span>
        <span class="c1"># for example).</span>
        <span class="k">return</span> <span class="n">serialize_json</span><span class="p">(</span><span class="n">json_like</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">'''</span>

<span class="sd">        '''</span>

        <span class="c1"># The explicit assumption here is that hinted events do not need to</span>
        <span class="c1"># go through all the same invalidation steps. Currently this is the</span>
        <span class="c1"># case for ColumnsStreamedEvent and ColumnsPatchedEvent. However,</span>
        <span class="c1"># this may need to be further refined in the future, if the</span>
        <span class="c1"># assumption does not hold for future hinted events (e.g. the hint</span>
        <span class="c1"># could specify explicitly whether to do normal invalidation or not)</span>
        <span class="k">if</span> <span class="n">hint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dirty</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'count'</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
            <span class="k">def</span> <span class="nf">mark_dirty</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="n">dirty</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">mark_dirty</span><span class="p">)</span>
                <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">mark_dirty</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dirty</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_document</span><span class="o">.</span><span class="n">_invalidate_all_models</span><span class="p">()</span>
        <span class="c1"># chain up to invoke callbacks</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="sd">''' Attach a model to a Bokeh |Document|.</span>

<span class="sd">        This private interface should only ever called by the Document</span>
<span class="sd">        implementation to set the private ._document field properly</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">doc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Models must be owned by only a single document, </span><span class="si">%r</span><span class="s2"> is already in a doc"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">theme</span><span class="o">.</span><span class="n">apply_to_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_document</span> <span class="o">=</span> <span class="n">doc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_event_callbacks</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_clear_extensions</span><span class="p">():</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">model_class_reverse_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_class_reverse_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">"__implementation__"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">"__javascript__"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">"__css__"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_detach_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Detach a model from a Bokeh |Document|.</span>

<span class="sd">        This private interface should only ever called by the Document</span>
<span class="sd">        implementation to unset the private ._document field properly</span>

<span class="sd">        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_document</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">default_theme</span><span class="o">.</span><span class="n">apply_to_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_json_like</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_defaults</span><span class="p">):</span>
        <span class="sd">''' Returns a dictionary of the attributes of this object, in</span>
<span class="sd">        a layout corresponding to what BokehJS expects at unmarshalling time.</span>

<span class="sd">        This method does not convert "Bokeh types" into "plain JSON types,"</span>
<span class="sd">        for example each child Model will still be a Model, rather</span>
<span class="sd">        than turning into a reference, numpy isn't handled, etc.</span>
<span class="sd">        That's what "json like" means.</span>

<span class="sd">        This method should be considered "private" or "protected",</span>
<span class="sd">        for use internal to Bokeh; use ``to_json()`` instead because</span>
<span class="sd">        it gives you only plain JSON-compatible types.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_defaults (bool) : whether to include attributes</span>
<span class="sd">                that haven't been changed from the default.</span>

<span class="sd">        '''</span>
        <span class="n">all_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties_with_values</span><span class="p">(</span><span class="n">include_defaults</span><span class="o">=</span><span class="n">include_defaults</span><span class="p">)</span>

        <span class="c1"># If __subtype__ is defined, then this model may introduce properties</span>
        <span class="c1"># that don't exist on __view_model__ in bokehjs. Don't serialize such</span>
        <span class="c1"># properties.</span>
        <span class="n">subtype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="s2">"__subtype__"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">subtype</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__view_model__</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">all_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">all_attrs</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># we can't serialize Infinity, we send it as None and</span>
            <span class="c1"># the other side has to fix it up. This transformation</span>
            <span class="c1"># can't be in our json_encoder because the json</span>
            <span class="c1"># module checks for inf before it calls the custom</span>
            <span class="c1"># encoder.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s1">'inf'</span><span class="p">):</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">'''</span>

<span class="sd">        '''</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">_id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">cls_name</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">row</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">'&lt;div style="display: table-row;"&gt;'</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s1">'&lt;/div&gt;'</span>
        <span class="k">def</span> <span class="nf">hidden_row</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">'&lt;div class="</span><span class="si">%s</span><span class="s1">" style="display: none;"&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;'</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls_name</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">cell</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">'&lt;div style="display: table-cell;"&gt;'</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s1">'&lt;/div&gt;'</span>

        <span class="n">html</span> <span class="o">=</span> <span class="s1">''</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">'&lt;div style="display: table;"&gt;'</span>

        <span class="n">ellipsis_id</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">()</span>
        <span class="n">ellipsis</span> <span class="o">=</span> <span class="s1">'&lt;span id="</span><span class="si">%s</span><span class="s1">" style="cursor: pointer;"&gt;&amp;hellip;)&lt;/span&gt;'</span> <span class="o">%</span> <span class="n">ellipsis_id</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="s1">'&lt;b title="</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">"&gt;</span><span class="si">%s</span><span class="s1">&lt;/b&gt;('</span> <span class="o">%</span> <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="n">row</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">cell</span><span class="p">(</span><span class="s1">'id'</span> <span class="o">+</span> <span class="s1">'&amp;nbsp;=&amp;nbsp;'</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">', '</span> <span class="o">+</span> <span class="n">ellipsis</span><span class="p">))</span>

        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties_with_values</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">sorted_props</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">all_props</span> <span class="o">=</span> <span class="n">sorted_props</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_props</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="s1">')'</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_props</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">','</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="n">hidden_row</span><span class="p">(</span><span class="n">cell</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span> <span class="o">+</span> <span class="n">cell</span><span class="p">(</span><span class="n">prop</span> <span class="o">+</span> <span class="s1">'&amp;nbsp;=&amp;nbsp;'</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span><span class="p">))</span>

        <span class="n">html</span> <span class="o">+=</span> <span class="s1">'&lt;/div&gt;'</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="n">_HTML_REPR</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ellipsis_id</span><span class="o">=</span><span class="n">ellipsis_id</span><span class="p">,</span> <span class="n">cls_name</span><span class="o">=</span><span class="n">cls_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">html</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Private API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">_visit_immediate_value_references</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
    <span class="sd">''' Visit all references to another Model without recursing into any</span>
<span class="sd">    of the child Model; may visit the same Model more than once if</span>
<span class="sd">    it's referenced more than once. Does not visit the passed-in value.</span>

<span class="sd">    '''</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">HasProps</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">properties_with_refs</span><span class="p">():</span>
            <span class="n">child</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span>


<span class="n">_common_types</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
    <span class="sd">''' Recurse down Models, HasProps, and Python containers</span>

<span class="sd">    The ordering in this function is to optimize performance.  We check the</span>
<span class="sd">    most comomn types (int, float, str) first so that we can quickly return in</span>
<span class="sd">    the common case.  We avoid isinstance and issubclass checks in a couple</span>
<span class="sd">    places with `type` checks because isinstance checks can be slow.</span>
<span class="sd">    '''</span>
    <span class="n">typ</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">_common_types</span><span class="p">:</span>  <span class="c1"># short circuit on common base types</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>  <span class="c1"># check common containers</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span>
            <span class="n">_visit_value_and_its_immediate_references</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">HasProps</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
            <span class="n">visitor</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this isn't a Model, so recurse into it</span>
            <span class="n">_visit_immediate_value_references</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span>


<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Code</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
<!-- END MAIN BODY OF DOCS ––––––––––––– -->
<!-- Google Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154795830-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154795830-2', { 'anonymize_ip': true });
</script>
<!-- MathJax Config -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>