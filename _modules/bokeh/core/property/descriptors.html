<!DOCTYPE html>

<html lang="en">
<head>
<!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<meta charset="utf-8"/>
<title>bokeh.core.property.descriptors — Panel 0.10.3 documentation</title>
<meta content="High-level dashboarding for python visualization libraries" name="description"/>
<meta content="Panel contributors" name="author"/>
<!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
    WebFont.load({
      google: {
        families: ['Source Sans Pro']
      }
    });
  </script>
<!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="../../../../_static/css/main.css" rel="stylesheet"/>
<link href="../../../../_static/nbsite.css" rel="stylesheet"/>
<link href="../../../../_static/site.css" rel="stylesheet"/>
<!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<script src="../../../../_static/js/main.js"></script>
<!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="../../../../_static/favicon.ico" rel="icon" type="image/png"/>
<!-- Canonical
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="https://panel.holoviz.org/_modules/bokeh/core/property/descriptors.html" rel="canonical">
</link></head>
<body class="">
<header class="navigation">
<div class="wrapper">
<a class="logo" href="../../../../index.html">
<img alt="Logo" src="../../../../_static/logo_horizontal.png"/>
</a>
<a class="navigation-menu-button" href="javascript:void(0)" id="js-mobile-menu">Menu</a>
<nav>
<ul class="navigation-menu show" id="js-navigation-menu">
<li class="nav-link doc-head"><a href="//discourse.holoviz.org">Discourse</a></li>
<li class="nav-link doc-head"><a href="//twitter.com/Panel_org">Twitter</a></li>
<li class="nav-link doc-head"><a href="//github.com/pyviz/panel">Github</a></li>
<li class="nav-link">
<div style="display:inline-block;vertical-align: middle;">
<div class="search-bar">
<form action="../../../../search.html" method="get" role="search">
<input name="q" placeholder="Search" type="search"/>
<button type="submit">
<img alt="Search Icon" src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png"/>
</button>
</form>
</div>
</div>
</li>
</ul>
</nav>
</div>
</header>
<div class="second-nav">
<nav>
<ul class="navigation-menu show">
<li class="nav-link doc-head"><a href="../../../../getting_started/index.html">Getting started</a></li>
<li class="nav-link doc-head"><a href="../../../../user_guide/index.html">User Guide</a></li>
<li class="nav-link doc-head"><a href="../../../../gallery/index.html">Gallery</a></li>
<li class="nav-link doc-head"><a href="../../../../reference/index.html">Reference Gallery</a></li>
<li class="nav-link doc-head"><a href="../../../../developer_guide/index.html">Developer Guide</a></li>
<li class="nav-link doc-head"><a href="../../../../releases.html">Releases</a></li>
<li class="nav-link doc-head"><a href="../../../../api/index.html">API</a></li>
<li class="nav-link doc-head"><a href="../../../../FAQ.html">FAQ</a></li>
<li class="nav-link doc-head"><a href="../../../../about.html">About</a></li>
</ul>
</nav>
</div>
<!-- MAIN BODY OF DOCS –––––––––––––––––– -->
<div class="docs section">
<div id="hacketyhackhack"> <!-- style="width:20%;margin-right: 100px;"> --> <!--style="display: none;"> style="display:none;"> -->
<div class="toc" style="width:15%; margin-right:20px;">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">Reference Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Comparisons.html">Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Roadmap.html">Road Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pyviz/panel">Github source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about.html">About</a></li>
</ul>
</div>
</div>
<div class="content"> <!-- style="max-width:80%;margin-left:auto;margin-right: auto;">-->
<h1>Source code for bokeh.core.property.descriptors</h1><div class="highlight"><pre>
<span></span><span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) 2012 - 2020, Anaconda, Inc., and Bokeh Contributors.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># The full license is in the file LICENSE.txt, distributed with this software.</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="sd">''' Provide Python descriptors for delegating to Bokeh properties.</span>

<span class="sd">The Python `descriptor protocol`_ allows fine-grained control over all</span>
<span class="sd">attribute access on instances ("You control the dot"). Bokeh uses the</span>
<span class="sd">descriptor protocol to provide easy-to-use, declarative, type-based</span>
<span class="sd">class properties that can automatically validate and serialize their</span>
<span class="sd">values, as well as help provide sophisticated documentation.</span>

<span class="sd">A Bokeh property really consist of two parts: a familiar "property"</span>
<span class="sd">portion, such as ``Int``, ``String``, etc., as well as an associated</span>
<span class="sd">Python descriptor that delegates attribute access to the property instance.</span>

<span class="sd">For example, a very simplified definition of a range-like object might</span>
<span class="sd">be:</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    from bokeh.model import Model</span>
<span class="sd">    from bokeh.core.properties import Float</span>

<span class="sd">    class Range(Model):</span>
<span class="sd">        start = Float(help="start point")</span>
<span class="sd">        end   = Float(help="end point")</span>

<span class="sd">When this class is created, the ``MetaHasProps`` metaclass wires up both</span>
<span class="sd">the ``start`` and ``end`` attributes to a ``Float`` property. Then, when</span>
<span class="sd">a user accesses those attributes, the descriptor delegates all get and</span>
<span class="sd">set operations to the ``Float`` property.</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    rng = Range()</span>

<span class="sd">    # The descriptor __set__ method delegates to Float, which can validate</span>
<span class="sd">    # the value 10.3 as a valid floating point value</span>
<span class="sd">    rng.start = 10.3</span>

<span class="sd">    # But can raise a validation exception if an attempt to set to a list</span>
<span class="sd">    # is made</span>
<span class="sd">    rng.end = [1,2,3]   # ValueError !</span>

<span class="sd">More sophisticated properties such as ``DataSpec`` and its subclasses can</span>
<span class="sd">exert control over how values are serialized. Consider this example with</span>
<span class="sd">the ``Circle`` glyph and its ``x`` attribute that is a ``NumberSpec``:</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    from bokeh.models import Circle</span>

<span class="sd">    c = Circle()</span>

<span class="sd">    c.x = 10      # serializes to {'value': 10}</span>

<span class="sd">    c.x = 'foo'   # serializes to {'field': 'foo'}</span>

<span class="sd">There are many other examples like this throughout Bokeh. In this way users</span>
<span class="sd">may operate simply and naturally, and not be concerned with the low-level</span>
<span class="sd">details around validation, serialization, and documentation.</span>

<span class="sd">This module provides the class |PropertyDescriptor| and various subclasses</span>
<span class="sd">that can be used to attach Bokeh properties to Bokeh models.</span>

<span class="sd">.. note::</span>
<span class="sd">    These classes form part of the very low-level machinery that implements</span>
<span class="sd">    the Bokeh model and property system. It is unlikely that any of these</span>
<span class="sd">    classes or their methods will be applicable to any standard usage or to</span>
<span class="sd">    anyone who is not directly developing on Bokeh's own infrastructure.</span>

<span class="sd">.. _descriptor protocol: https://docs.python.org/3/howto/descriptor.html</span>

<span class="sd">'''</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Boilerplate</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">logging</span> <span class="c1"># isort:skip</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Imports</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1"># Standard library imports</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="c1"># Bokeh imports</span>
<span class="kn">from</span> <span class="nn">.wrappers</span> <span class="kn">import</span> <span class="n">PropertyValueColumnData</span><span class="p">,</span> <span class="n">PropertyValueContainer</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Globals and constants</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">'BasicPropertyDescriptor'</span><span class="p">,</span>
    <span class="s1">'ColumnDataPropertyDescriptor'</span><span class="p">,</span>
    <span class="s1">'DataSpecPropertyDescriptor'</span><span class="p">,</span>
    <span class="s1">'PropertyDescriptor'</span><span class="p">,</span>
    <span class="s1">'UnitsSpecPropertyDescriptor'</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># General API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Dev API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="k">class</span> <span class="nc">PropertyDescriptor</span><span class="p">:</span>
    <span class="sd">''' Base class for a python descriptor that delegates access for a named</span>
<span class="sd">    attribute to a Bokeh |Property| instance.</span>

<span class="sd">    '''</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">''' Create a descriptor for a hooking up a named Bokeh property</span>
<span class="sd">        as an attribute on a |HasProps| class.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str) : the attribute name that this descriptor is for</span>

<span class="sd">        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Basic string representation of ``PropertyDescriptor``.</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="s2">"PropertyDescriptor(</span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="sd">''' Implement the getter for the Python `descriptor protocol`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps or None) :</span>
<span class="sd">                The instance to set a new property value on (for instance</span>
<span class="sd">                attribute access), or None (for class attribute access)</span>

<span class="sd">            owner (obj) :</span>
<span class="sd">                The new value to set the property to</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement __get__"</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Implement the setter for the Python `descriptor protocol`_.</span>

<span class="sd">        .. note::</span>
<span class="sd">            An optional argument ``setter`` has been added to the standard</span>
<span class="sd">            setter arguments. When needed, this value should be provided by</span>
<span class="sd">            explicitly invoking ``__set__``. See below for more information.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>
<span class="sd">                The instance to set a new property value on</span>

<span class="sd">            value (obj) :</span>
<span class="sd">                The new value to set the property to</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement __set__"</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">''' Implement the deleter for the Python `descriptor protocol`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) : An instance to delete this property from</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement __delete__"</span><span class="p">)</span>

    <span class="c1"># This would probably be cleaner with some form of multiple dispatch</span>
    <span class="c1"># on (descriptor, property). Currently this method has to know about</span>
    <span class="c1"># various other classes, and that is annoying.</span>
    <span class="k">def</span> <span class="nf">add_prop_descriptor_to_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">new_class_attrs</span><span class="p">,</span> <span class="n">names_with_refs</span><span class="p">,</span> <span class="n">container_names</span><span class="p">,</span> <span class="n">dataspecs</span><span class="p">):</span>
        <span class="sd">''' ``MetaHasProps`` calls this during class creation as it iterates</span>
<span class="sd">        over properties to add, to update its registry of new properties.</span>

<span class="sd">        The parameters passed in are mutable and this function is expected to</span>
<span class="sd">        update them accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            class_name (str) :</span>
<span class="sd">                name of the class this descriptor is added to</span>

<span class="sd">            new_class_attrs(dict[str, PropertyDescriptor]) :</span>
<span class="sd">                mapping of attribute names to PropertyDescriptor that this</span>
<span class="sd">                function will update</span>

<span class="sd">            names_with_refs (set[str]) :</span>
<span class="sd">                set of all property names for properties that also have</span>
<span class="sd">                references, that this function will update</span>

<span class="sd">            container_names (set[str]) :</span>
<span class="sd">                set of all property names for properties that are</span>
<span class="sd">                container props, that this function will update</span>

<span class="sd">            dataspecs(dict[str, PropertyDescriptor]) :</span>
<span class="sd">                mapping of attribute names to PropertyDescriptor for DataSpec</span>
<span class="sd">                properties that this function will update</span>

<span class="sd">        Return:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="kn">from</span> <span class="nn">.bases</span> <span class="kn">import</span> <span class="n">ContainerProperty</span>
        <span class="kn">from</span> <span class="nn">.dataspec</span> <span class="kn">import</span> <span class="n">DataSpec</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">new_class_attrs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Two property generators both created </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">new_class_attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ref</span><span class="p">:</span>
            <span class="n">names_with_refs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BasicPropertyDescriptor</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">,</span> <span class="n">ContainerProperty</span><span class="p">):</span>
                <span class="n">container_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">,</span> <span class="n">DataSpec</span><span class="p">):</span>
                <span class="n">dataspecs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">class_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="sd">''' The default as computed for a certain class, ignoring any</span>
<span class="sd">        per-instance theming.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement class_default()"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serializable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">''' Produce the value as it should be serialized.</span>

<span class="sd">        Sometimes it is desirable for the serialized value to differ from</span>
<span class="sd">        the ``__get__`` in order for the ``__get__`` value to appear simpler</span>
<span class="sd">        for user or developer convenience.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) : the object to get the serialized attribute for</span>

<span class="sd">        Returns:</span>
<span class="sd">            JSON-like</span>

<span class="sd">        '''</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">serialize_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">'''Sets the value of this property from a JSON value.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj: (HasProps) : instance to set the property value on</span>

<span class="sd">            json: (JSON-value) : value to set to the attribute to</span>

<span class="sd">            models (dict or None, optional) :</span>
<span class="sd">                Mapping of model ids to models (default: None)</span>

<span class="sd">                This is needed in cases where the attributes to update also</span>
<span class="sd">                have values that have references.</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trigger_if_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">):</span>
        <span class="sd">''' Send a change event notification if the property is set to a</span>
<span class="sd">        value is not equal to ``old``.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps)</span>
<span class="sd">                The object the property is being set on.</span>

<span class="sd">            old (obj) :</span>
<span class="sd">                The previous value of the property to compare</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement trigger_if_changed()"</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Whether the property can refer to another ``HasProps`` instance.</span>

<span class="sd">        This is typically True for container properties, ``Instance``, etc.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement has_ref()"</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Whether this property is read-only.</span>

<span class="sd">        Read-only properties may only be modified by the client (i.e., by</span>
<span class="sd">        BokehJS, in the browser). Read only properties are useful for</span>
<span class="sd">        quantities that originate or that can only be computed in the</span>
<span class="sd">        browser, for instance the "inner" plot dimension of a plot area,</span>
<span class="sd">        which depend on the current layout state. It is useful for Python</span>
<span class="sd">        callbacks to be able to know these values, but they can only be</span>
<span class="sd">        computed in the actual browser.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement readonly()"</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">serialized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Whether the property should be serialized when serializing</span>
<span class="sd">        an object.</span>

<span class="sd">        This would be False for a "virtual" or "convenience" property that</span>
<span class="sd">        duplicates information already available in other properties, for</span>
<span class="sd">        example.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement serialized()"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_internal_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Internal implementation to set property values, that is used</span>
<span class="sd">        by __set__, set_from_json, etc.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps)</span>
<span class="sd">                The object the property is being set on.</span>

<span class="sd">            old (obj) :</span>
<span class="sd">                The previous value of the property to compare</span>

<span class="sd">            hint (event hint or None, optional)</span>
<span class="sd">                An optional update event hint, e.g. ``ColumnStreamedEvent``</span>
<span class="sd">                (default: None)</span>

<span class="sd">                Update event hints are usually used at times when better</span>
<span class="sd">                update performance can be obtained by special-casing in</span>
<span class="sd">                some way (e.g. streaming or patching column data sources)</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError</span>

<span class="sd">        **Subclasses must implement this to serve their specific needs.**</span>

<span class="sd">        '''</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Implement _internal_set()"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BasicPropertyDescriptor</span><span class="p">(</span><span class="n">PropertyDescriptor</span><span class="p">):</span>
    <span class="sd">''' A ``PropertyDescriptor`` for basic Bokeh properties (e.g, ``Int``,</span>
<span class="sd">    ``String``, ``Float``, etc.) with simple get/set and serialization</span>
<span class="sd">    behavior.</span>

<span class="sd">    '''</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
        <span class="sd">''' Create a PropertyDescriptor for basic Bokeh properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str) : The attribute name that this property is for</span>
<span class="sd">            property (Property) : A basic property to create a descriptor for</span>

<span class="sd">        '''</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property</span> <span class="o">=</span> <span class="nb">property</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Basic string representation of ``BasicPropertyDescriptor``.</span>

<span class="sd">        Delegates to ``self.property.__str__``</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span>

    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="sd">''' Implement the getter for the Python `descriptor protocol`_.</span>

<span class="sd">        For instance attribute access, we delegate to the |Property|. For</span>
<span class="sd">        class attribute access, we return ourself.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps or None) :</span>
<span class="sd">                The instance to set a new property value on (for instance</span>
<span class="sd">                attribute access), or None (for class attribute access)</span>

<span class="sd">            owner (obj) :</span>
<span class="sd">                The new value to set the property to</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Examples:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                &gt;&gt;&gt; from bokeh.models import Range1d</span>

<span class="sd">                &gt;&gt;&gt; r = Range1d(start=10, end=20)</span>

<span class="sd">                # instance attribute access, returns the property value</span>
<span class="sd">                &gt;&gt;&gt; r.start</span>
<span class="sd">                10</span>

<span class="sd">                # class attribute access, returns the property descriptor</span>
<span class="sd">                &gt;&gt;&gt; Range1d.start</span>
<span class="sd">                &lt;bokeh.core.property.descriptors.BasicPropertyDescriptor at 0x1148b3390&gt;</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">owner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This should really never happen. If it does, it means we've</span>
            <span class="c1"># called __get__ explicitly but in a bad way.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"both 'obj' and 'owner' are None, don't know what to do"</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Implement the setter for the Python `descriptor protocol`_.</span>

<span class="sd">        .. note::</span>
<span class="sd">            An optional argument ``setter`` has been added to the standard</span>
<span class="sd">            setter arguments. When needed, this value should be provided by</span>
<span class="sd">            explicitly invoking ``__set__``. See below for more information.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>
<span class="sd">                The instance to set a new property value on</span>

<span class="sd">            value (obj) :</span>
<span class="sd">                The new value to set the property to</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'_property_values'</span><span class="p">):</span>
            <span class="c1"># Initial values should be passed in to __init__, not set directly</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Cannot set a property value '</span><span class="si">%s</span><span class="s2">' on a </span><span class="si">%s</span><span class="s2"> instance before HasProps.__init__"</span> <span class="o">%</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">_readonly</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> is a readonly property"</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">''' Implement the deleter for the Python `descriptor protocol`_.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) : An instance to delete this property from</span>

<span class="sd">        '''</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">:</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_if_changed</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">old_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_default_values</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_default_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">class_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="sd">''' Get the default value for a specific subtype of ``HasProps``,</span>
<span class="sd">        which may not be used for an individual instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            cls (class) : The class to get the default value for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            object</span>


<span class="sd">        '''</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">themed_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instance_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">''' Get the default value that will be used for a specific instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) : The instance to get the default value for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            object</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">themed_default</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">themed_values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">set_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Sets the value of this property from a JSON value.</span>

<span class="sd">        This method first</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>

<span class="sd">            json (JSON-dict) :</span>

<span class="sd">            models(seq[Model], optional) :</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_from_json</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="p">),</span>
                                                        <span class="n">models</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trigger_if_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">):</span>
        <span class="sd">''' Send a change event notification if the property is set to a</span>
<span class="sd">        value is not equal to ``old``.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps)</span>
<span class="sd">                The object the property is being set on.</span>

<span class="sd">            old (obj) :</span>
<span class="sd">                The previous value of the property to compare</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Whether the property can refer to another ``HasProps`` instance.</span>

<span class="sd">        For basic properties, delegate to the ``has_ref`` attribute on the</span>
<span class="sd">        |Property|.</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">has_ref</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Whether this property is read-only.</span>

<span class="sd">        Read-only properties may only be modified by the client (i.e., by BokehJS</span>
<span class="sd">        in the browser).</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">readonly</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">serialized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Whether the property should be serialized when serializing an</span>
<span class="sd">        object.</span>

<span class="sd">        This would be False for a "virtual" or "convenience" property that</span>
<span class="sd">        duplicates information already available in other properties, for</span>
<span class="sd">        example.</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">serialized</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">''' Internal implementation of instance attribute access for the</span>
<span class="sd">        ``BasicPropertyDescriptor`` getter.</span>

<span class="sd">        If the value has not been explicitly set by a user, return that</span>
<span class="sd">        value. Otherwise, return the default.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) : the instance to get a value of this property for</span>

<span class="sd">        Returns:</span>
<span class="sd">            object</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError</span>
<span class="sd">                If the |HasProps| instance has not yet been initialized, or if</span>
<span class="sd">                this descriptor is on a class that is not a |HasProps|.</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'_property_values'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Cannot get a property value '</span><span class="si">%s</span><span class="s2">' from a </span><span class="si">%s</span><span class="s2"> instance before HasProps.__init__"</span> <span class="o">%</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">''' Internal implementation of instance attribute access for default</span>
<span class="sd">        values.</span>

<span class="sd">        Handles bookeeping around |PropertyContainer| value, etc.</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">:</span>
            <span class="c1"># this shouldn't happen because we should have checked before _get_default()</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Bokeh internal error, does not handle the case of self.name already in _property_values"</span><span class="p">)</span>

        <span class="n">is_themed</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">themed_values</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">themed_values</span><span class="p">()</span>

        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_themed</span><span class="p">:</span>
            <span class="n">unstable_dict</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_themed_values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unstable_dict</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_default_values</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">unstable_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unstable_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">_may_have_unstable_default</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">PropertyValueContainer</span><span class="p">):</span>
                <span class="n">default</span><span class="o">.</span><span class="n">_register_owner</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">unstable_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>

        <span class="k">return</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">_internal_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Internal implementation to set property values, that is used</span>
<span class="sd">        by __set__, set_from_json, etc.</span>

<span class="sd">        Delegate to the |Property| instance to prepare the value appropriately,</span>
<span class="sd">        then `set.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps)</span>
<span class="sd">                The object the property is being set on.</span>

<span class="sd">            old (obj) :</span>
<span class="sd">                The previous value of the property to compare</span>

<span class="sd">            hint (event hint or None, optional)</span>
<span class="sd">                An optional update event hint, e.g. ``ColumnStreamedEvent``</span>
<span class="sd">                (default: None)</span>

<span class="sd">                Update event hints are usually used at times when better</span>
<span class="sd">                update performance can be obtained by special-casing in</span>
<span class="sd">                some way (e.g. streaming or patching column data sources)</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">prepare_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_real_set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_real_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Internal implementation helper to set property values.</span>

<span class="sd">        This function handles bookkeeping around noting whether values have</span>
<span class="sd">        been explicitly set, etc.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps)</span>
<span class="sd">                The object the property is being set on.</span>

<span class="sd">            old (obj) :</span>
<span class="sd">                The previous value of the property to compare</span>

<span class="sd">            hint (event hint or None, optional)</span>
<span class="sd">                An optional update event hint, e.g. ``ColumnStreamedEvent``</span>
<span class="sd">                (default: None)</span>

<span class="sd">                Update event hints are usually used at times when better</span>
<span class="sd">                update performance can be obtained by special-casing in</span>
<span class="sd">                some way (e.g. streaming or patching column data sources)</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="c1"># Normally we want a "no-op" if the new value and old value are identical</span>
        <span class="c1"># but some hinted events are in-place. This check will allow those cases</span>
        <span class="c1"># to continue on to the notification machinery</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">old</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">was_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span>

        <span class="c1"># "old" is the logical old value, but it may not be the actual current</span>
        <span class="c1"># attribute value if our value was mutated behind our back and we got</span>
        <span class="c1"># _notify_mutated.</span>
        <span class="k">if</span> <span class="n">was_set</span><span class="p">:</span>
            <span class="n">old_attr_value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_attr_value</span> <span class="o">=</span> <span class="n">old</span>

        <span class="k">if</span> <span class="n">old_attr_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_attr_value</span><span class="p">,</span> <span class="n">PropertyValueContainer</span><span class="p">):</span>
                <span class="n">old_attr_value</span><span class="o">.</span><span class="n">_unregister_owner</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">PropertyValueContainer</span><span class="p">):</span>
                <span class="n">value</span><span class="o">.</span><span class="n">_register_owner</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_themed_values</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_themed_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_default_values</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">obj</span><span class="o">.</span><span class="n">_unstable_default_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

            <span class="n">obj</span><span class="o">.</span><span class="n">_property_values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># for notification purposes, "old" should be the logical old</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>

    <span class="c1"># called when a container is mutated "behind our back" and</span>
    <span class="c1"># we detect it with our collection wrappers.</span>
    <span class="k">def</span> <span class="nf">_notify_mutated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' A method to call when a container is mutated "behind our back"</span>
<span class="sd">        and we detect it with our |PropertyContainer| wrappers.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>
<span class="sd">                The object who's container value was mutated</span>

<span class="sd">            old (object) :</span>
<span class="sd">                The "old" value of the container</span>

<span class="sd">                In this case, somewhat weirdly, ``old`` is a copy and the</span>
<span class="sd">                new value should already be set unless we change it due to</span>
<span class="sd">                validation.</span>

<span class="sd">            hint (event hint or None, optional)</span>
<span class="sd">                An optional update event hint, e.g. ``ColumnStreamedEvent``</span>
<span class="sd">                (default: None)</span>

<span class="sd">                Update event hints are usually used at times when better</span>
<span class="sd">                update performance can be obtained by special-casing in</span>
<span class="sd">                some way (e.g. streaming or patching column data sources)</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="c1"># re-validate because the contents of 'old' have changed,</span>
        <span class="c1"># in some cases this could give us a new object for the value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">prepare_value</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_real_set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Unconditionally send a change event notification for the property.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps)</span>
<span class="sd">                The object the property is being set on.</span>

<span class="sd">            old (obj) :</span>
<span class="sd">                The previous value of the property</span>

<span class="sd">            new (obj) :</span>
<span class="sd">                The new value of the property</span>

<span class="sd">            hint (event hint or None, optional)</span>
<span class="sd">                An optional update event hint, e.g. ``ColumnStreamedEvent``</span>
<span class="sd">                (default: None)</span>

<span class="sd">                Update event hints are usually used at times when better</span>
<span class="sd">                update performance can be obtained by special-casing in</span>
<span class="sd">                some way (e.g. streaming or patching column data sources)</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>


<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'trigger'</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>


<span class="n">_CDS_SET_FROM_CDS_ERROR</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">ColumnDataSource.data properties may only be set from plain Python dicts,</span>
<span class="s2">not other ColumnDataSource.data values.</span>

<span class="s2">If you need to copy set from one CDS to another, make a shallow copy by</span>
<span class="s2">calling dict: s1.data = dict(s2.data)</span>
<span class="s2">"""</span>

<span class="k">class</span> <span class="nc">ColumnDataPropertyDescriptor</span><span class="p">(</span><span class="n">BasicPropertyDescriptor</span><span class="p">):</span>
    <span class="sd">''' A ``PropertyDescriptor`` specialized to handling ``ColumnData`` properties.</span>

<span class="sd">    '''</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Implement the setter for the Python `descriptor protocol`_.</span>

<span class="sd">        This method first separately extracts and removes any ``units`` field</span>
<span class="sd">        in the JSON, and sets the associated units property directly. The</span>
<span class="sd">        remaining value is then passed to the superclass ``__set__`` to</span>
<span class="sd">        be handled.</span>

<span class="sd">        .. note::</span>
<span class="sd">            An optional argument ``setter`` has been added to the standard</span>
<span class="sd">            setter arguments. When needed, this value should be provided by</span>
<span class="sd">            explicitly invoking ``__set__``. See below for more information.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>
<span class="sd">                The instance to set a new property value on</span>

<span class="sd">            value (obj) :</span>
<span class="sd">                The new value to set the property to</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">'_property_values'</span><span class="p">):</span>
            <span class="c1"># Initial values should be passed in to __init__, not set directly</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Cannot set a property value '</span><span class="si">%s</span><span class="s2">' on a </span><span class="si">%s</span><span class="s2"> instance before HasProps.__init__"</span> <span class="o">%</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">_readonly</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> is a readonly property"</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">PropertyValueColumnData</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_CDS_SET_FROM_CDS_ERROR</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">...document.events</span> <span class="kn">import</span> <span class="n">ColumnDataChangedEvent</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">document</span><span class="p">:</span>
            <span class="n">hint</span> <span class="o">=</span> <span class="n">ColumnDataChangedEvent</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hint</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_set</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="n">setter</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DataSpecPropertyDescriptor</span><span class="p">(</span><span class="n">BasicPropertyDescriptor</span><span class="p">):</span>
    <span class="sd">''' A ``PropertyDescriptor`` for Bokeh |DataSpec| properties that serialize to</span>
<span class="sd">    field/value dictionaries.</span>

<span class="sd">    '''</span>

    <span class="k">def</span> <span class="nf">serializable_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">'''</span>

<span class="sd">        '''</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">to_serializable</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Sets the value of this property from a JSON value.</span>

<span class="sd">        This method first</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>

<span class="sd">            json (JSON-dict) :</span>

<span class="sd">            models(seq[Model], optional) :</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># we want to try to keep the "format" of the data spec as string, dict, or number,</span>
            <span class="c1"># assuming the serialized dict is compatible with that.</span>
            <span class="n">old</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">_type</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">'value'</span> <span class="ow">in</span> <span class="n">json</span><span class="p">:</span>
                        <span class="n">json</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">'field'</span> <span class="ow">in</span> <span class="n">json</span><span class="p">:</span>
                        <span class="n">json</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s1">'field'</span><span class="p">]</span>
                <span class="c1"># leave it as a dict if 'old' was a dict</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_from_json</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UnitsSpecPropertyDescriptor</span><span class="p">(</span><span class="n">DataSpecPropertyDescriptor</span><span class="p">):</span>
    <span class="sd">''' A ``PropertyDecscriptor`` for Bokeh |UnitsSpec| properties that contribute</span>
<span class="sd">    associated ``_units`` properties automatically as a side effect.</span>

<span class="sd">    '''</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">units_property</span><span class="p">):</span>
        <span class="sd">'''</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str) :</span>
<span class="sd">                The attribute name that this property is for</span>

<span class="sd">            property (Property) :</span>
<span class="sd">                A basic property to create a descriptor for</span>

<span class="sd">            units_property (Property) :</span>
<span class="sd">                An associated property to hold units information</span>

<span class="sd">        '''</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units_prop</span> <span class="o">=</span> <span class="n">units_property</span>

    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Implement the setter for the Python `descriptor protocol`_.</span>

<span class="sd">        This method first separately extracts and removes any ``units`` field</span>
<span class="sd">        in the JSON, and sets the associated units property directly. The</span>
<span class="sd">        remaining value is then passed to the superclass ``__set__`` to</span>
<span class="sd">        be handled.</span>

<span class="sd">        .. note::</span>
<span class="sd">            An optional argument ``setter`` has been added to the standard</span>
<span class="sd">            setter arguments. When needed, this value should be provided by</span>
<span class="sd">            explicitly invoking ``__set__``. See below for more information.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) :</span>
<span class="sd">                The instance to set a new property value on</span>

<span class="sd">            value (obj) :</span>
<span class="sd">                The new value to set the property to</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_units</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Sets the value of this property from a JSON value.</span>

<span class="sd">        This method first separately extracts and removes any ``units`` field</span>
<span class="sd">        in the JSON, and sets the associated units property directly. The</span>
<span class="sd">        remaining JSON is then passed to the superclass ``set_from_json`` to</span>
<span class="sd">        be handled.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj: (HasProps) : instance to set the property value on</span>

<span class="sd">            json: (JSON-value) : value to set to the attribute to</span>

<span class="sd">            models (dict or None, optional) :</span>
<span class="sd">                Mapping of model ids to models (default: None)</span>

<span class="sd">                This is needed in cases where the attributes to update also</span>
<span class="sd">                have values that have references.</span>

<span class="sd">            setter (ClientSession or ServerSession or None, optional) :</span>
<span class="sd">                This is used to prevent "boomerang" updates to Bokeh apps.</span>
<span class="sd">                (default: None)</span>

<span class="sd">                In the context of a Bokeh server application, incoming updates</span>
<span class="sd">                to properties will be annotated with the session that is</span>
<span class="sd">                doing the updating. This value is propagated through any</span>
<span class="sd">                subsequent change notifications that the update triggers.</span>
<span class="sd">                The session can compare the event setter to itself, and</span>
<span class="sd">                suppress any updates that originate from itself.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        '''</span>
        <span class="n">json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_units</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_from_json</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">''' Internal helper for dealing with units associated units properties</span>
<span class="sd">        when setting values on |UnitsSpec| properties.</span>

<span class="sd">        When ``value`` is a dict, this function may mutate the value of the</span>
<span class="sd">        associated units property.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (HasProps) : instance to update units spec property value for</span>
<span class="sd">            value (obj) : new value to set for the property</span>

<span class="sd">        Returns:</span>
<span class="sd">            copy of ``value``, with 'units' key and value removed when</span>
<span class="sd">            applicable</span>

<span class="sd">        '''</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">'units'</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1"># so we can modify it</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"units"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">units</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">units_prop</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Private API</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Code</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
<!-- END MAIN BODY OF DOCS ––––––––––––– -->
<!-- Google Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154795830-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154795830-2', { 'anonymize_ip': true });
</script>
<!-- MathJax Config -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>